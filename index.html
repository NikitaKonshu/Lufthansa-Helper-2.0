<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LOT Premium v151</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        /* === PREMIUM VARIABLES === */
        :root {
            --lot-blue-dark: #0b1a38;
            --lot-blue-light: #1e3a8a;
            --accent-gold: #c5a47e; 
            --accent-gold-glow: rgba(197, 164, 126, 0.4);
            --bg-deep: #050b14;
            --glass-panel: rgba(20, 25, 40, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-blur: blur(40px);
            --text-main: #ffffff;
            --text-sec: #94a3b8;
            --radius-lg: 24px;
            --radius-md: 16px;
            --nav-h: 85px;
            --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* === GLOBAL RESET === */
        html, body {
            width: 100%; height: 100%;
            overflow-x: hidden; position: relative;
            touch-action: pan-y; margin: 0; padding: 0;
            box-sizing: border-box; -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Inter', sans-serif; 
            background: radial-gradient(circle at 50% 0%, #172a52 0%, #050b14 80%);
            background-attachment: fixed;
            color: var(--text-main);
            padding-top: 0; padding-bottom: 140px; 
        }
        .hidden { display: none !important; }
        h1, h2, h3, h4 { margin: 0; font-weight: 700; letter-spacing: -0.02em; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* === LOADER === */
        #flight-loader {
            position: fixed; inset: 0; background: rgba(5, 11, 20, 0.95); backdrop-filter: blur(20px);
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #flight-loader.active { opacity: 1; pointer-events: all; }
        .loader-spinner { width: 60px; height: 60px; border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--accent-gold); border-radius: 50%; animation: spin 1s cubic-bezier(0.5,0,0.5,1) infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* === HEADER & DROPDOWN === */
        header { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); 
            width: 92%; max-width: 600px; height: 60px; 
            background: rgba(10, 15, 30, 0.8); backdrop-filter: blur(20px); 
            border: 1px solid var(--glass-border); border-radius: 30px;
            z-index: 2000; display: flex; justify-content: center; align-items: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: pointer; transition: 0.3s;
        }
        header:active { transform: translateX(-50%) scale(0.98); }
        .brand { font-weight: 800; font-size: 0.95rem; letter-spacing: 1px; text-transform: uppercase; color: #fff; }
        
        /* About Dropdown Panel */
        #about-panel {
            position: fixed; top: 85px; left: 50%; transform: translateX(-50%) translateY(-20px);
            width: 90%; max-width: 580px;
            background: rgba(15, 20, 35, 0.9); backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border); border-radius: 24px;
            padding: 25px; text-align: center;
            opacity: 0; pointer-events: none; transition: 0.4s var(--ease-out); z-index: 1990;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        #about-panel.open { transform: translateX(-50%) translateY(0); opacity: 1; pointer-events: all; }

        .header-spacer { height: 110px; width: 100%; }

        /* === 3D CAROUSEL (THE "RAINBOW") === */
        #airline-wheel-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px);
            z-index: 3000; display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.5s; perspective: 1000px; overflow: hidden;
        }
        #airline-wheel-modal.active { opacity: 1; pointer-events: all; }
        
        .wheel-container {
            width: 300px; height: 300px; position: relative;
            transform-style: preserve-3d;
            animation: rotateWheel 20s linear infinite;
        }
        /* Pause on hover/touch */
        .wheel-container:hover, .wheel-container:active { animation-play-state: paused; }
        
        @keyframes rotateWheel {
            from { transform: rotateX(0deg); }
            to { transform: rotateX(-360deg); }
        }

        .wheel-item {
            position: absolute; top: 50%; left: 50%;
            width: 240px; height: 80px; margin-left: -120px; margin-top: -40px;
            background: rgba(255,255,255,0.05); border: 1px solid var(--accent-gold);
            border-radius: 16px; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; font-weight: 800; color: #fff; text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(197, 164, 126, 0.1);
            backface-visibility: hidden; cursor: pointer; transition: 0.3s;
        }
        .wheel-item:hover { background: var(--accent-gold); color: #000; box-shadow: 0 0 40px var(--accent-gold-glow); }
        
        /* === UI ELEMENTS === */
        .container { max-width: 800px; margin: 0 auto; padding: 0 20px; }
        .anim-item, .ticket { background: var(--glass-panel); backdrop-filter: blur(30px); border: 1px solid var(--glass-border); box-shadow: 0 15px 40px rgba(0,0,0,0.25); border-radius: var(--radius-lg); position: relative; margin-bottom: 20px; transition: transform 0.2s; }
        .anim-item { padding: 24px; }
        .anim-item:active { transform: scale(0.99); }
        
        .ticket { padding: 0 !important; display: flex; overflow: hidden; cursor: pointer; }
        .ticket-l { flex: 1; padding: 22px; position: relative; }
        .ticket-r { width: 80px; background: linear-gradient(180deg, var(--accent-gold) 0%, #8f7250 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; color: #000; }
        .al-tag { font-size: 0.7rem; font-weight: 700; color: var(--accent-gold); letter-spacing: 1px; margin-bottom: 8px; text-transform: uppercase; }
        .route-path { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .ap { font-size: 1.8rem; font-weight: 800; color: #fff; line-height: 1; }
        .ap-lbl { font-size: 0.65rem; color: var(--text-sec); font-weight: 600; letter-spacing: 1px; margin-top: 5px; }
        
        button { font-family: 'Inter', sans-serif; border: none; cursor: pointer; }
        .btn-primary { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--accent-gold) 0%, #8f7250 100%); color: #050b14; font-weight: 800; font-size: 1rem; letter-spacing: 0.5px; border-radius: var(--radius-md); box-shadow: 0 10px 25px var(--accent-gold-glow); transition: transform 0.2s; }
        .btn-primary:active { transform: scale(0.97); }
        
        .btn-filter { background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: #fff; padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 0.8rem; letter-spacing: 0.5px; }

        .nav-dock { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; height: var(--nav-h); background: rgba(10, 15, 30, 0.85); backdrop-filter: blur(30px); border-radius: 35px; border: 1px solid var(--glass-border); box-shadow: 0 20px 50px rgba(0,0,0,0.6); z-index: 1900; display: flex; justify-content: space-evenly; align-items: center; }
        .nav-btn { background: none; border: none; color: #556677; display: flex; flex-direction: column; align-items: center; transition: 0.3s; }
        .nav-btn i { font-style: normal; font-size: 1.6rem; margin-bottom: 6px; display: block; filter: grayscale(1); transition: 0.3s; }
        .nav-btn span { font-size: 0.65rem; font-weight: 600; letter-spacing: 0.5px; opacity: 0.7; }
        .nav-btn.active { color: #fff; } 
        .nav-btn.active i { transform: translateY(-5px); filter: grayscale(0) drop-shadow(0 0 5px rgba(255,255,255,0.5)); }

        .tab-view { display: none; opacity: 0; transform: translateY(20px); transition: none; }
        .tab-view.active { display: block; animation: tabEntrance 0.5s var(--ease-out) forwards; }
        @keyframes tabEntrance { to { opacity: 1; transform: translateY(0); } }

        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 5000; align-items: flex-end; justify-content: center; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.visible { opacity: 1; }
        .modal-body { width: 100%; max-width: 600px; background: #111620; border-radius: 36px 36px 0 0; padding: 40px 30px; max-height: 85vh; overflow-y: auto; border-top: 1px solid rgba(255,255,255,0.15); box-shadow: 0 -20px 60px rgba(0,0,0,0.7); transform: translateY(100%); transition: transform 0.4s var(--ease-out); color: #fff; }
        .modal-overlay.visible .modal-body { transform: translateY(0); }

        .chip { padding: 12px 20px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; color: #ddd; margin: 5px; display: inline-block; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .chip.active { background: var(--accent-gold); color: #000; border-color: var(--accent-gold); font-weight: 800; }

        .ios-input { width: 100%; padding: 18px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 18px; margin-bottom: 16px; font-size: 1.1rem; color: #fff; text-align: center; font-weight: 500; transition: 0.3s; }
        .ios-input:focus { border-color: var(--accent-gold); outline: none; background: rgba(255,255,255,0.1); }

        .ofp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; margin-top: 20px; }
        .ofp-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .ofp-lbl { font-size: 0.7rem; color: #666; font-weight: 600; font-family: 'JetBrains Mono'; display: block; margin-bottom: 5px; letter-spacing: 1px; }
        .ofp-val { font-size: 1.2rem; color: var(--accent-gold); font-weight: 700; font-family: 'JetBrains Mono'; }

        #map-wrap { height: 450px; border-radius: 24px; overflow: hidden; border: 1px solid var(--glass-border); position: relative; }
        .leaflet-popup-content-wrapper { background: #1a202c; color: #fff; border: 1px solid #444; }
        
        #intro { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .btn-float { position: fixed; bottom: 130px; right: 25px; width: 64px; height: 64px; border-radius: 50%; background: var(--accent-gold); color: #000; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; z-index: 1800; border: 2px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="intro">
    <div style="font-size:2.5rem; font-weight:300; letter-spacing:4px; color:#fff; animation:fadeIn 1s forwards;">LOT POLISH</div>
    <div style="width:60px; height:2px; background:var(--accent-gold); margin:20px 0; opacity:0; animation:fadeIn 1s forwards 0.5s;"></div>
    <div style="font-size:0.9rem; font-weight:700; color:#666; letter-spacing:2px; animation:fadeIn 1s forwards 0.8s; opacity:0;">FLIGHT OPERATIONS</div>
    <style>@keyframes fadeIn{to{opacity:1}}</style>
</div>

<div id="flight-loader">
    <div class="loader-spinner"></div>
    <div style="color:var(--accent-gold); font-family:'JetBrains Mono'; margin-top:25px; font-size:0.8rem; letter-spacing:2px; text-transform:uppercase;" id="loader-msg">Connecting...</div>
</div>

<header onclick="app.toggleAbout()">
    <div class="brand">LOT Polish Airlines ‚ñæ</div>
</header>

<div id="about-panel">
    <h3 style="color:#fff; font-size:1.5rem; margin-bottom:5px;">System Info</h3>
    <p style="color:#888; margin-bottom:20px; font-size:0.9rem;">EFN/LOT Portal v151.0 (Stable)</p>
    
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; text-align:left;">
        <div class="ofp-box" style="text-align:center;"><span class="ofp-lbl">STATUS</span><span class="ofp-val" style="color:#22c55e;">ONLINE</span></div>
        <div class="ofp-box" style="text-align:center;"><span class="ofp-lbl">SERVER</span><span class="ofp-val">EU-CENTRAL</span></div>
    </div>
    <p style="color:#555; font-size:0.8rem; margin-top:20px;">¬© 2024 LOT Polish Airlines Virtual.<br>Authorized Personnel Only.</p>
</div>

<div class="nav-dock hidden" id="nav">
    <button class="nav-btn active" onclick="app.nav('dash')"><i>‚åÇ</i><span>HOME</span></button>
    <button class="nav-btn" onclick="app.nav('routes')"><i>‚úà</i><span>FLIGHTS</span></button>
    <button class="nav-btn" onclick="app.nav('fleet')"><i>‚óà</i><span>HANGAR</span></button>
    <button class="nav-btn" onclick="app.nav('map')"><i>‚óç</i><span>MAP</span></button>
    <button class="nav-btn" onclick="app.nav('crew')"><i>‚ò∫</i><span>CREW</span></button>
</div>

<div id="airline-wheel-modal">
    <div style="position:absolute; top:100px; color:var(--text-sec); font-size:0.9rem; letter-spacing:2px; text-transform:uppercase;">Select Hangar</div>
    <div class="wheel-container" id="wheel-container">
        </div>
    <div style="position:absolute; bottom:100px; padding:12px 24px; background:rgba(255,255,255,0.1); border-radius:30px; color:#fff; cursor:pointer;" onclick="app.closeWheel()">Close Hangar</div>
</div>

<div id="login-modal" class="modal-overlay">
    <div class="modal-body" style="background:transparent; border:none; box-shadow:none; height:100%; align-items:center; justify-content:center; display:flex; flex-direction:column;">
        <div style="font-size:3.5rem; margin-bottom:10px;">‚úà</div>
        <h2 style="font-size:2rem; font-weight:300; color:#fff; margin-bottom:5px;">Welcome</h2>
        <p style="color:#666; margin-bottom:40px; font-size:0.9rem; letter-spacing:1px; text-transform:uppercase;">Sign in to operations</p>
        <input type="text" id="travel-id" class="ios-input" placeholder="PILOT ID (e.g. LOT001)">
        <input type="password" id="travel-pass" class="ios-input" placeholder="ACCESS CODE">
        <button class="btn-primary" onclick="app.login()" style="margin-top:20px;">AUTHENTICATE</button>
        <p id="login-err" style="color:#ef4444; margin-top:20px; font-weight:700; font-size:0.8rem; letter-spacing:1px;"></p>
    </div>
</div>

<div class="container hidden" id="app">
    <div id="view-dash" class="tab-view active">
        <div class="header-spacer"></div>
        <div id="pilot-profile-card"></div>
        <div class="anim-item">
            <h3 style="font-size:1.5rem; color:#fff; font-weight:300;">Daily Roster</h3>
            <p style="font-size:0.8rem; color:var(--text-sec); margin-bottom:25px; font-family:'JetBrains Mono'; margin-top:5px;">UTC /// 08:00 ZULU</p>
            <div id="daily-content" style="font-size:1.8rem; font-weight:800; margin-bottom:25px; color:#fff;">Loading...</div>
            <button class="btn-primary" onclick="app.prep(app.dailyIdx)">INITIATE BRIEFING</button>
        </div>
        <div id="flight-card" class="anim-item hidden" style="border: 1px solid var(--accent-gold);">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <span style="font-weight:900; color:var(--accent-gold); font-size:0.8rem; letter-spacing:1px;">ACTIVE FLIGHT</span>
                <span id="af-timer" class="mono" style="font-size:0.9rem; color:#fff;">00:00:00</span>
            </div>
            <h2 id="af-route" style="font-size:2.5rem; font-weight:200; margin-bottom:5px;">DEP - ARR</h2>
            <p id="af-ac" style="color:var(--text-sec); font-family:'JetBrains Mono'; font-size:0.8rem; margin-bottom:25px;">A320neo / LO492</p>
            <div style="height:4px; background:rgba(255,255,255,0.1); border-radius:2px; overflow:hidden;">
                <div id="af-bar" style="height:100%; width:0%; background:var(--accent-gold); box-shadow: 0 0 10px var(--accent-gold); transition: width 1s linear;"></div>
            </div>
            <button class="btn-primary" style="background:transparent; border:1px solid rgba(255,255,255,0.2); margin-top:30px; color:#fff; box-shadow:none;" onclick="app.cancel()">ABORT FLIGHT</button>
        </div>
    </div>

    <div id="view-routes" class="tab-view">
        <div class="header-spacer"></div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <div style="font-weight:200; font-size:2rem;">Departures</div>
            <button class="btn-filter" onclick="app.openFilter('routes')">FILTER</button>
        </div>
        <div id="routes-list"></div>
        <button class="btn-float" onclick="app.openGenerator()">üé≤</button>
    </div>

    <div id="view-fleet" class="tab-view">
        <div class="header-spacer"></div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <div class="title" style="font-weight:200; font-size:2rem;">Hangar <span id="fleet-filter-lbl" style="font-size:1rem; color:var(--accent-gold); font-weight:700;">(ALL)</span></div>
            <button class="btn-filter" onclick="app.openWheel()">CHANGE</button>
        </div>
        <div id="fleet-list"></div>
    </div>

    <div id="view-map" class="tab-view">
        <div class="header-spacer"></div>
        <div style="margin-bottom:20px;"><div style="font-weight:200; font-size:2rem;">Network</div></div>
        <div class="anim-item" style="padding:0; overflow:hidden; border:none;">
            <div id="map-wrap">
                <button class="btn-filter" style="position:absolute; top:20px; right:20px; z-index:1000; background:rgba(0,0,0,0.8);" onclick="app.openFilter('map')">LAYERS</button>
                <div id="map-c" style="width:100%; height:100%;"></div>
            </div>
        </div>
    </div>

    <div id="view-crew" class="tab-view">
        <div class="header-spacer"></div>
        <div style="margin-bottom:20px;"><div style="font-weight:200; font-size:2rem;">Ops Center</div></div>
        <div style="display:flex; gap:10px; margin-bottom:25px;">
            <button id="seg-roster" class="btn-filter active" style="flex:1; justify-content:center;" onclick="app.crewTab('roster')">ROSTER</button>
            <button id="seg-news" class="btn-filter" style="flex:1; justify-content:center;" onclick="app.crewTab('news')">NOTAMS</button>
        </div>
        <div id="crew-roster-view"></div>
        <div id="crew-news-view" class="hidden"></div>
    </div>
</div>

<div id="gen-modal" class="modal-overlay">
    <div class="modal-body">
        <h3 style="color:#fff;">Flight Generator</h3>
        <div style="margin-bottom:30px;">
            <label style="color:#666; font-size:0.8rem; display:block; margin-bottom:15px; font-weight:700;">DURATION</label>
            <div style="display:flex; flex-wrap:wrap;">
                <div class="chip active" onclick="app.setGen('time', 'ALL', this)">ANY</div>
                <div class="chip" onclick="app.setGen('time', 'SHORT', this)">SHORT</div>
                <div class="chip" onclick="app.setGen('time', 'MEDIUM', this)">MEDIUM</div>
                <div class="chip" onclick="app.setGen('time', 'LONG', this)">LONG</div>
            </div>
        </div>
        <button class="btn-primary" onclick="app.generateSmart()">SEARCH ROUTES</button>
        <button class="btn-primary" style="margin-top:15px; background:transparent; border:1px solid #333; color:#fff; box-shadow:none;" onclick="app.closeM()">CANCEL</button>
    </div>
</div>

<div id="filter-modal" class="modal-overlay">
    <div class="modal-body">
        <h3 style="color:#fff;">Filter Data</h3>
        <div id="filter-container" style="display:flex; flex-wrap:wrap;"></div>
        <button class="btn-primary" style="margin-top:20px; background:transparent; border:1px solid #333; color:#fff; box-shadow:none;" onclick="app.closeM()">CLOSE</button>
    </div>
</div>

<div id="pilot-view-modal" class="modal-overlay">
    <div class="modal-body">
        <div id="pv-content"></div>
        <button class="btn-primary" style="margin-top:20px; background:transparent; border:1px solid #333; color:#fff; box-shadow:none;" onclick="app.closeM()">CLOSE</button>
    </div>
</div>

<div id="news-read-modal" class="modal-overlay">
    <div class="modal-body">
        <span id="nr-tag" style="color:var(--accent-gold); font-weight:700; font-size:0.8rem; letter-spacing:1px; border:1px solid var(--accent-gold); padding:2px 8px; border-radius:4px;"></span>
        <h2 id="nr-title" style="margin:20px 0; color:#fff; font-weight:300; font-size:1.8rem; line-height:1.3;"></h2>
        <p id="nr-body" style="color:#ccc; line-height:1.7; font-size:1.05rem;"></p>
        <button class="btn-primary" style="margin-top:30px; background:transparent; border:1px solid #333; color:#fff; box-shadow:none;" onclick="app.closeM()">CLOSE</button>
    </div>
</div>

<div id="efb-modal" class="modal-overlay">
    <div class="modal-body efb-body" style="background:#080808; padding:0; overflow:hidden;">
        <div style="background:#151515; padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333;">
            <span class="mono" style="color:#888; font-weight:700;">LOT // OFP RELEASE</span>
            <span style="background:var(--accent-gold); color:#000; padding:4px 10px; border-radius:4px; font-weight:800; font-size:0.8rem;">CLEARED</span>
        </div>
        <div style="padding:30px;">
            <div class="ofp-grid">
                <div class="ofp-box"><span class="ofp-lbl">CALLSIGN</span><span class="ofp-val" id="br-cs"></span></div>
                <div class="ofp-box"><span class="ofp-lbl">AIRCRAFT</span><span class="ofp-val" id="br-ac"></span></div>
                <div class="ofp-box"><span class="ofp-lbl">ORIGIN</span><span class="ofp-val" id="br-dep"></span></div>
                <div class="ofp-box"><span class="ofp-lbl">DESTINATION</span><span class="ofp-val" id="br-arr"></span></div>
                <div class="ofp-box"><span class="ofp-lbl">BLOCK FUEL</span><span class="ofp-val" id="br-fuel"></span></div>
                <div class="ofp-box"><span class="ofp-lbl">EST TIME</span><span class="ofp-val" id="br-time"></span></div>
                <div class="ofp-box"><span class="ofp-lbl">PAX</span><span class="ofp-val" id="br-pax"></span></div>
                <div class="ofp-box"><span class="ofp-lbl">GATE</span><span class="ofp-val" id="br-gate"></span></div>
            </div>
            <button class="btn-primary" style="background:#fff; color:#000;" onclick="app.accept()">ACCEPT & SIGN</button>
            <button class="btn-primary" style="background:transparent; color:#666; border:1px solid #333; margin-top:10px; box-shadow:none;" onclick="app.closeM()">REJECT</button>
        </div>
    </div>
</div>

<script>
    const DB = {
        PILOTS: [
            { id: "LOT001", pwd: "1234", name: "Capt. Mueller", rank: "Captain", base: "EDDF", callsign: "GHOST", platform: "Discord" },
            { id: "LOT002", pwd: "1234", name: "F.O. Weber", rank: "First Officer", base: "EDDM", callsign: "SPEEDBIRD", platform: "Telegram" },
            { id: "LOT003", pwd: "1234", name: "S.O. Schmidt", rank: "Second Officer", base: "LSZH", callsign: "ALPINE", platform: "VK" }
        ],
        ROUTES: [
            { al: "LOT", code: "LO", d: "EDDF", a: "EGLL", t: 1.5, ac: "A320neo", fuel: "5.8t" },
            { al: "Swiss", code: "LX", d: "LSZH", a: "KJFK", t: 8.8, ac: "A330-300", fuel: "105.0t" },
            { al: "Austrian", code: "OS", d: "LOWW", a: "VTBS", t: 10.0, ac: "B777-200", fuel: "130.0t" },
            { al: "Eurowings", code: "EW", d: "EDDL", a: "LEPA", t: 2.2, ac: "A320", fuel: "8.5t" },
            { al: "Condor", code: "DE", d: "EDDF", a: "CUN", t: 11.5, ac: "A330neo", fuel: "85.0t" },
            { al: "Air Dolomiti", code: "EN", d: "EDDM", a: "LIPZ", t: 0.8, ac: "E195", fuel: "4.0t" },
            { al: "Brussels", code: "SN", d: "EBBR", a: "GOSS", t: 6.5, ac: "A330", fuel: "50.0t" },
            { al: "Discover", code: "4Y", d: "EDDF", a: "VTAA", t: 10.5, ac: "A330-300", fuel: "90.0t" },
            { al: "Edelweiss", code: "WK", d: "LSZH", a: "MLE", t: 9.5, ac: "A340-300", fuel: "100.0t" },
            { al: "Croatia", code: "OU", d: "LDZA", a: "EDDF", t: 1.5, ac: "A319", fuel: "6.0t" },
            { al: "LOT", code: "LO", d: "EPWA", a: "KJFK", t: 9.0, ac: "B787-9", fuel: "80.0t" },
            { al: "Luxair", code: "LG", d: "ELLX", a: "LPPR", t: 2.5, ac: "B737-8", fuel: "10.0t" },
            { al: "TAP", code: "TP", d: "LPPT", a: "SBGL", t: 10.0, ac: "A330neo", fuel: "95.0t" }
        ],
        FLEET: [
            { t: "Airbus A320neo", op: "LOT", r: "6,300km", spd: "M0.82", mtow: "79t" },
            { t: "Boeing 747-8", op: "LOT", r: "14,800km", spd: "M0.86", mtow: "447t" },
            { t: "Airbus A330-300", op: "Swiss", r: "11,750km", spd: "M0.86", mtow: "242t" },
            { t: "Embraer 195", op: "Air Dolomiti", r: "4,200km", spd: "M0.78", mtow: "52t" },
            { t: "Boeing 777-200", op: "Austrian", r: "13,650km", spd: "M0.84", mtow: "297t" }
        ],
        COORDS: { "EDDF":[50.03,8.56], "EGLL":[51.47,-0.45], "KJFK":[40.64,-73.77], "EDDM":[48.35,11.77], "LSZH":[47.45,8.55], "LOWW":[48.11,16.56], "VTBS":[13.69,100.75], "EDDL":[51.28,6.76], "LEPA":[39.55,2.73], "CUN":[21.04,-86.87], "LIPZ":[45.50,12.35], "EBBR":[50.90,4.48], "MLE":[4.19,73.52], "LDZA":[45.74,16.06], "LPPT":[38.77,-9.13] },
        GATES: ["A10", "Z50", "E05", "G08", "K14", "B22", "C15"],
        NEWS: [
            { t: "Network Update", d: "Added TAP, SAS, Finnair.", body: "We have expanded the network with new routes from TAP, SAS, Finnair and ITA. Please update your charts accordingly.", tag: "UPDATE" },
            { t: "Winter Operations", d: "De-icing mandatory.", body: "Severe winter conditions in Munich and Zurich. De-icing is mandatory for all departures. Expect delays of 15-20 minutes.", tag: "ALERT" }
        ]
    };

    const app = {
        user: null, active: null, temp: null, map: null, dailyIdx: 0,
        filters: { al: 'ALL' },
        gen: { time: 'ALL', al: 'ALL' },
        stats: { h: 0, l: 0 },

        init: function() {
            setTimeout(() => { document.getElementById('login-modal').classList.add('visible'); document.getElementById('login-modal').style.display='flex'; }, 100);

            const s = JSON.parse(localStorage.getItem('lot_stats_v151'));
            if(s) this.stats = s;
            const f = JSON.parse(localStorage.getItem('lot_flight'));
            if(f) { this.active = f; this.timer(); }

            const today = new Date().toDateString();
            let hash = 0;
            for(let i=0; i<today.length; i++) hash = today.charCodeAt(i) + ((hash << 5) - hash);
            this.dailyIdx = Math.abs(hash) % DB.ROUTES.length;

            setTimeout(() => {
                const intro = document.getElementById('intro');
                intro.style.opacity = '0';
                setTimeout(() => intro.classList.add('hidden'), 1000);
            }, 3000);

            this.renderR(); this.renderF(); this.dailyUI();
        },

        login: function() {
            const u = document.getElementById('travel-id').value.toUpperCase();
            const p = document.getElementById('travel-pass').value;
            const pilot = DB.PILOTS.find(x => x.id === u && x.pwd === p);
            if(pilot) {
                this.user = pilot;
                document.getElementById('login-modal').classList.remove('visible');
                setTimeout(() => {
                    document.getElementById('login-modal').style.display = 'none';
                    document.getElementById('nav').classList.remove('hidden');
                    const appC = document.getElementById('app');
                    appC.classList.remove('hidden');
                    document.getElementById('view-dash').classList.add('active');
                    this.profile();
                    this.renderC();
                }, 400);
            } else document.getElementById('login-err').innerText = "INVALID CREDENTIALS";
        },

        toggleAbout: function() {
            document.getElementById('about-panel').classList.toggle('open');
        },

        nav: function(id) {
            // Special handling for fleet to show wheel first
            if(id === 'fleet') {
                this.openWheel();
                return;
            }

            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            const oldTab = document.querySelector('.tab-view.active');
            if(oldTab) oldTab.classList.remove('active');
            const newTab = document.getElementById('view-'+id);
            newTab.classList.add('active'); 
            if(id === 'map') this.initMap();
        },

        /* === 3D WHEEL LOGIC === */
        openWheel: function() {
            const modal = document.getElementById('airline-wheel-modal');
            const container = document.getElementById('wheel-container');
            container.innerHTML = ''; // Reset

            const airlines = ['ALL', ...new Set(DB.ROUTES.map(r => r.al))];
            const radius = 220; // Radius of the wheel
            const angleStep = 360 / airlines.length;

            airlines.forEach((al, index) => {
                const item = document.createElement('div');
                item.className = 'wheel-item';
                item.innerText = al;
                // Calculate position on cylinder
                item.style.transform = `rotateX(${index * angleStep}deg) translateZ(${radius}px)`;
                item.onclick = () => { this.selectFleet(al); };
                container.appendChild(item);
            });

            modal.classList.add('active');
        },

        closeWheel: function() {
            document.getElementById('airline-wheel-modal').classList.remove('active');
        },

        selectFleet: function(airline) {
            this.closeWheel();
            this.renderF(airline);
            
            // Switch tab to fleet view
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.nav-btn')[2].classList.add('active'); // Fleet btn
            
            document.querySelectorAll('.tab-view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-fleet').classList.add('active');
            
            document.getElementById('fleet-filter-lbl').innerText = `(${airline})`;
        },

        /* === CORE LOGIC === */
        profile: function() {
            document.getElementById('pilot-profile-card').className = 'anim-item';
            document.getElementById('pilot-profile-card').innerHTML = `<div style="display:flex; align-items:center; gap:20px; margin-bottom:20px;"><div style="width:70px; height:70px; border-radius:50%; background:var(--lot-blue-light); border:3px solid var(--accent-gold); display:flex; align-items:center; justify-content:center; font-size:1.5rem; color:#fff;">${this.user.name[0]}</div><div><h2 style="font-weight:700; color:#fff;">${this.user.name}</h2><p style="color:var(--text-sec); font-size:0.9rem;">${this.user.rank} ‚Ä¢ ${this.user.base}</p></div></div><div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; background:rgba(255,255,255,0.05); padding:15px; border-radius:16px;"><div style="text-align:center;"><div style="font-size:0.7rem; color:#666; letter-spacing:1px;">FLIGHT HOURS</div><div style="font-size:1.4rem; font-weight:700; color:#fff;">${Math.floor(this.stats.h)}</div></div><div style="text-align:center;"><div style="font-size:0.7rem; color:#666; letter-spacing:1px;">SECTORS</div><div style="font-size:1.4rem; font-weight:700; color:#fff;">${this.stats.l}</div></div></div>`;
        },
        renderR: function() {
            const l = document.getElementById('routes-list'); l.innerHTML = '';
            DB.ROUTES.forEach((r, i) => {
                if(this.filters.al !== 'ALL' && r.al !== this.filters.al) return;
                l.innerHTML += `<div class="ticket anim-item" onclick="app.prep(${i})"><div class="ticket-l"><div class="al-tag">${r.al}</div><div class="route-path"><div><div class="ap">${r.d}</div><div class="ap-lbl">DEP</div></div><div class="icon-plane">‚úà</div><div style="text-align:right;"><div class="ap">${r.a}</div><div class="ap-lbl">ARR</div></div></div><div style="font-size:0.8rem; color:var(--text-sec);">${r.ac}</div></div><div class="ticket-r"><div style="font-family:'JetBrains Mono'; font-weight:700; font-size:0.9rem;">${r.t}h</div></div></div>`;
            });
        },
        renderF: function(f='ALL') {
            const l = document.getElementById('fleet-list'); l.innerHTML = '';
            // If selecting ALL, show everything, otherwise filter
            const list = f === 'ALL' ? DB.FLEET : DB.FLEET.filter(x => x.op === f);
            
            if(list.length === 0) {
                 l.innerHTML = `<div style="text-align:center; color:#666; padding:40px;">No aircraft found for ${f}</div>`;
                 return;
            }

            list.forEach(x => {
                l.innerHTML += `<div class="anim-item"><div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.05); padding-bottom:10px;"><span style="font-weight:700; color:#fff;">${x.t}</span><span style="font-size:0.7rem; font-weight:700; background:var(--accent-gold); color:#000; padding:3px 8px; border-radius:6px;">${x.op}</span></div><div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;"><div><div style="font-size:0.6rem; color:#666;">RANGE</div><div style="font-size:0.9rem; font-weight:600; color:#fff;">${x.r}</div></div><div><div style="font-size:0.6rem; color:#666;">SPEED</div><div style="font-size:0.9rem; font-weight:600; color:#fff;">${x.spd}</div></div><div><div style="font-size:0.6rem; color:#666;">MTOW</div><div style="font-size:0.9rem; font-weight:600; color:#fff;">${x.mtow}</div></div></div></div>`;
            });
        },
        renderC: function() {
            if(!this.user) return;
            document.getElementById('crew-roster-view').innerHTML = DB.PILOTS.filter(p=>p.id!==this.user.id).map(p=>`<div class="anim-item" style="display:flex; align-items:center; gap:15px;" onclick="app.viewPilot('${p.id}')"><div style="width:50px; height:50px; border-radius:50%; background:#222; display:flex; align-items:center; justify-content:center; color:#fff; border:2px solid #444;">${p.name[0]}</div><div><div style="font-weight:700; color:#fff;">${p.name}</div><div style="font-size:0.8rem; color:#666;">${p.rank}</div></div></div>`).join('');
            document.getElementById('crew-news-view').innerHTML = DB.NEWS.map((n,i)=>`<div class="anim-item" onclick="app.readNews(${i})"><div><span style="font-size:0.7rem; font-weight:800; color:var(--accent-gold); border:1px solid var(--accent-gold); padding:2px 6px; border-radius:4px;">${n.tag}</span><h4 style="margin:10px 0; color:#fff;">${n.t}</h4><p style="font-size:0.9rem; color:#666;">${n.d}</p></div></div>`).join('');
        },
        crewTab: function(t) {
            document.getElementById('seg-roster').classList.toggle('active', t==='roster'); document.getElementById('seg-roster').style.background = t==='roster' ? 'var(--accent-gold)' : 'rgba(255,255,255,0.1)'; document.getElementById('seg-roster').style.color = t==='roster' ? '#000' : '#fff';
            document.getElementById('seg-news').classList.toggle('active', t==='news'); document.getElementById('seg-news').style.background = t==='news' ? 'var(--accent-gold)' : 'rgba(255,255,255,0.1)'; document.getElementById('seg-news').style.color = t==='news' ? '#000' : '#fff';
            document.getElementById('crew-roster-view').classList.toggle('hidden', t!=='roster');
            document.getElementById('crew-news-view').classList.toggle('hidden', t!=='news');
        },
        viewPilot: function(id) {
            const p = DB.PILOTS.find(x => x.id === id); if(!p) return;
            document.getElementById('pv-content').innerHTML = `<div style="text-align:center; margin-bottom:20px;"><div style="width:80px; height:80px; border-radius:50%; background:var(--lot-blue-light); margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:2rem; color:#fff; border:4px solid var(--accent-gold);">${p.name[0]}</div><h2 style="font-weight:800; color:#fff;">${p.name}</h2><p style="color:#666;">${p.rank} ‚Ä¢ ${p.base}</p></div><div style="display:grid; grid-template-columns:1fr; gap:10px;"><div style="background:#1a1a1a; padding:15px; border-radius:10px;"><label style="font-size:0.7rem; color:#555;">CALLSIGN</label><div style="color:#fff;">${p.callsign}</div></div><div style="background:#1a1a1a; padding:15px; border-radius:10px;"><label style="font-size:0.7rem; color:#555;">ID</label><div style="color:#fff;">${p.id}</div></div></div>`;
            this.openM('pilot-view-modal');
        },
        readNews: function(i) {
            const n = DB.NEWS[i]; document.getElementById('nr-tag').innerText = n.tag; document.getElementById('nr-title').innerText = n.t; document.getElementById('nr-body').innerText = n.body; this.openM('news-read-modal');
        },
        dailyUI: function() { const r = DB.ROUTES[this.dailyIdx]; document.getElementById('daily-content').innerText = `${r.d} ‚ûù ${r.a} (${r.ac})`; },
        
        prep: function(i) {
            if(this.active) { alert("Flight in progress"); return; }
            const loader = document.getElementById('flight-loader');
            const txt = document.getElementById('loader-msg');
            
            loader.classList.add('active');
            txt.innerText = "CONNECTING TO DISPATCH...";
            
            setTimeout(() => {
                txt.innerText = "CALCULATING FUEL...";
                setTimeout(() => {
                    loader.classList.remove('active');
                    const r = DB.ROUTES[i];
                    this.temp = { ...r, n: 'LO'+Math.floor(Math.random()*900+100), gate: DB.GATES[Math.floor(Math.random()*DB.GATES.length)] };
                    document.getElementById('br-cs').innerText = this.temp.n; document.getElementById('br-ac').innerText = r.ac;
                    document.getElementById('br-dep').innerText = r.d; document.getElementById('br-arr').innerText = r.a;
                    document.getElementById('br-fuel').innerText = r.fuel; document.getElementById('br-time').innerText = r.t + ' H';
                    document.getElementById('br-pax').innerText = Math.floor(Math.random()*100+50); document.getElementById('br-gate').innerText = this.temp.gate;
                    this.openM('efb-modal');
                }, 1500);
            }, 800);
        },
        accept: function() {
            this.active = { ...this.temp, start: Date.now(), dur: this.temp.t * 3600 * 1000 };
            localStorage.setItem('lot_flight', JSON.stringify(this.active));
            this.closeM(); this.timer(); this.nav('dash');
        },
        timer: function() {
            document.getElementById('flight-card').classList.remove('hidden');
            document.getElementById('af-route').innerText = `${this.active.d} - ${this.active.a}`;
            document.getElementById('af-ac').innerText = `${this.active.ac} ‚Ä¢ ${this.active.n}`;
            this.tmr = setInterval(() => {
                const el = Date.now() - this.active.start;
                const pct = Math.min((el / this.active.dur)*100, 100);
                document.getElementById('af-bar').style.width = pct + "%";
                if(pct >= 100) this.finish();
                else {
                    const rem = this.active.dur - el;
                    const h = Math.floor(rem/3600000); const m = Math.floor((rem%3600000)/60000);
                    document.getElementById('af-timer').innerText = `${h}h ${m}m LEFT`;
                }
            }, 1000);
        },
        finish: function() { clearInterval(this.tmr); alert("Flight Complete."); this.stats.h += this.active.t; this.stats.l += 1; localStorage.setItem('lot_stats_v151', JSON.stringify(this.stats)); this.active = null; localStorage.removeItem('lot_flight'); document.getElementById('flight-card').classList.add('hidden'); this.profile(); },
        cancel: function() { if(confirm("Cancel?")) { clearInterval(this.tmr); this.active = null; localStorage.removeItem('lot_flight'); document.getElementById('flight-card').classList.add('hidden'); } },
        
        openFilter: function(type) {
            const c = document.getElementById('filter-container');
            const data = type === 'fleet' ? [...new Set(DB.FLEET.map(f => f.op))] : ['ALL', ...new Set(DB.ROUTES.map(r => r.al))];
            c.innerHTML = data.map(x => `<div class="chip" onclick="app.applyFilter('${type}', '${x}')">${x}</div>`).join('');
            this.openM('filter-modal');
        },
        applyFilter: function(t, v) { this.closeM(); if(t === 'routes') { this.filters.al = v; this.renderR(); } if(t === 'fleet') { this.renderF(v); } if(t === 'map') { this.filters.al = v; this.drawLines(v); } },
        
        openGenerator: function() { const c = document.getElementById('gen-al'); const als = ['ALL', ...new Set(DB.ROUTES.map(r => r.al))]; /*c.innerHTML = als.map(x => `<div class="chip" onclick="app.setGen('al', '${x}', this)">${x}</div>`).join('');*/ this.openM('gen-modal'); },
        setGen: function(cat, val, btn) { this.gen[cat] = val; btn.parentNode.querySelectorAll('.chip').forEach(c => c.classList.remove('active')); btn.classList.add('active'); },
        generateSmart: function() {
            let matches = DB.ROUTES.filter(r => { if(this.gen.al !== 'ALL' && r.al !== this.gen.al) return false; if(this.gen.time === 'SHORT' && r.t > 3) return false; if(this.gen.time === 'MEDIUM' && (r.t < 3 || r.t > 8)) return false; if(this.gen.time === 'LONG' && r.t < 8) return false; return true; });
            if(matches.length > 0) { const idx = DB.ROUTES.indexOf(matches[Math.floor(Math.random() * matches.length)]); this.closeM(); this.prep(idx); } else { alert("No routes match."); }
        },
        initMap: function() { 
            setTimeout(() => { 
                if(!this.map) { 
                    this.map = L.map('map-c').setView([48.5, 10], 5); 
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap &copy; CARTO', subdomains: 'abcd', maxZoom: 19 }).addTo(this.map); 
                    this.drawLines('ALL'); 
                } 
                this.map.invalidateSize(); 
            }, 100); 
        },
        drawLines: function(filter) { 
            this.map.eachLayer(layer => { if(layer instanceof L.Polyline || layer instanceof L.CircleMarker) this.map.removeLayer(layer); });
            let airports = {};
            DB.ROUTES.forEach((r, idx) => { 
                if(filter !== 'ALL' && r.al !== filter) return; 
                const c1 = DB.COORDS[r.d]; const c2 = DB.COORDS[r.a]; 
                if(c1 && c2) { 
                    L.polyline([c1, c2], { color: '#c5a47e', weight: 1, opacity: 0.5 }).addTo(this.map); 
                    if(!airports[r.d]) airports[r.d] = { c: c1, routes: [] };
                    airports[r.d].routes.push({ ...r, idx: idx });
                } 
            });
            for(const [apCode, data] of Object.entries(airports)) {
                const marker = L.circleMarker(data.c, { radius: 5, fillColor: '#c5a47e', color: '#000', weight: 1, opacity: 1, fillOpacity: 1 }).addTo(this.map);
                let html = `<div class="map-popup-header"><b>${apCode} Departures</b><span style="font-size:0.7rem;">${data.routes.length} Available Routes</span></div><div class="map-scroll-container">`;
                data.routes.forEach(route => { html += `<div class="map-flight-item"><div class="map-flight-info"><div class="map-flight-dest">${route.a} <span style="font-weight:400; color:#666;">(${route.al})</span></div><div style="font-size:0.75rem; color:#888;">${route.ac} ‚Ä¢ ${route.t}h</div></div><button class="btn-map-action" onclick="app.prep(${route.idx})">Fly</button></div>`; });
                html += `</div>`; marker.bindPopup(html);
            }
        },
        openM: function(id) { 
            const m = document.getElementById(id); m.style.display = 'flex'; 
            setTimeout(() => { m.classList.add('visible'); }, 10);
        },
        closeM: function() { 
            document.querySelectorAll('.modal-overlay.visible').forEach(m => {
                m.classList.remove('visible'); setTimeout(() => { m.style.display = 'none'; }, 300); 
            }); 
        }
    };
    window.onload = () => app.init();
</script>
</body>
</html>
