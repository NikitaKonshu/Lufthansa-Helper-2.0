<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LOT Premium v156</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        /* === VARIABLES === */
        :root {
            --accent-gold: #c5a47e; 
            --accent-gold-dark: #8f7250;
            --vip-gold: #ffd700;
            --bg-deep: #050b14;
            --glass-panel: rgba(15, 20, 35, 0.9);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-sec: #94a3b8;
            --radius-lg: 24px;
            --nav-h: 85px;
            --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* === BASE === */
        html, body {
            width: 100%; height: 100%; overflow-x: hidden; position: relative;
            touch-action: pan-y; margin: 0; padding: 0;
            background: radial-gradient(circle at 50% 0%, #172a52 0%, #050b14 80%);
            background-attachment: fixed; color: var(--text-main); font-family: 'Inter', sans-serif;
            padding-bottom: 140px;
        }
        .hidden { display: none !important; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* === SEAMLESS HEADER (FIXED) === */
        #header-wrapper {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 600px; z-index: 3000;
            display: flex; flex-direction: column;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
        }

        header { 
            width: 100%; height: 60px; 
            background: rgba(15, 20, 35, 0.95); backdrop-filter: blur(20px); 
            border: 1px solid var(--glass-border); border-radius: 30px;
            display: flex; justify-content: center; align-items: center; 
            cursor: pointer; position: relative; z-index: 2;
            transition: border-radius 0.3s var(--ease-out);
        }

        header.open {
            border-bottom-left-radius: 0; border-bottom-right-radius: 0;
            border-bottom: 1px solid transparent; /* Hide bottom border */
        }

        .brand { font-weight: 800; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; }
        
        #about-panel {
            width: 100%; background: rgba(15, 20, 35, 0.95); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-top: none;
            border-radius: 0 0 30px 30px;
            max-height: 0; opacity: 0; overflow: hidden;
            transition: all 0.4s var(--ease-out);
            position: relative; z-index: 1; padding: 0 25px;
        }

        #about-panel.open { max-height: 400px; opacity: 1; padding: 25px; padding-top: 10px; }

        /* === CARDS & BUTTONS === */
        .container { max-width: 800px; margin: 0 auto; padding: 0 20px; padding-top: 110px; }
        
        .anim-item { 
            background: var(--glass-panel); border: 1px solid var(--glass-border); 
            border-radius: var(--radius-lg); padding: 24px; margin-bottom: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn-primary { 
            width: 100%; padding: 16px; border-radius: 18px; border: none;
            background: linear-gradient(135deg, var(--accent-gold) 0%, #8f7250 100%);
            color: #000; font-weight: 800; font-size: 0.95rem; cursor: pointer;
            box-shadow: 0 5px 20px var(--accent-gold-glow); transition: 0.2s;
        }
        .btn-primary:active { transform: scale(0.97); }

        /* === VIP STYLES === */
        .vip-card {
            background: linear-gradient(135deg, #0a0a0a 0%, #1c1c1c 100%);
            border: 1px solid rgba(255, 215, 0, 0.3);
            position: relative; overflow: hidden;
        }
        .vip-input-group {
            display: flex; gap: 10px; margin-top: 15px;
        }
        .vip-input {
            flex: 1; background: rgba(0,0,0,0.3); border: 1px solid #444; color: #ffd700;
            padding: 12px; border-radius: 12px; font-family: 'JetBrains Mono'; text-transform: uppercase;
            outline: none; text-align: center;
        }
        .vip-save-btn {
            background: #ffd700; color: #000; border: none; border-radius: 12px;
            font-weight: 800; padding: 0 20px; cursor: pointer;
        }

        /* === OFP & MAPS === */
        /* Fixed Grid for OFP */
        .ofp-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;
        }
        .ofp-box {
            background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08);
        }
        .ofp-lbl { font-size: 0.65rem; color: #666; font-weight: 700; display: block; margin-bottom: 4px; }
        .ofp-val { font-size: 1.1rem; color: var(--accent-gold); font-family: 'JetBrains Mono'; font-weight: 700; }

        /* Small Map Containers */
        #ofp-map-container, #live-map-container {
            height: 200px; width: 100%; border-radius: 16px; margin-top: 15px;
            border: 1px solid #333; overflow: hidden; display: none; /* Hidden by default */
        }
        
        /* === TICKETS & CHIPS === */
        .ticket { display: flex; background: rgba(30,35,50,0.6); border-radius: 20px; overflow: hidden; margin-bottom: 15px; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); }
        .ticket-l { flex: 1; padding: 20px; }
        .ticket-r { width: 70px; background: #222; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono'; font-weight: 700; }
        
        .nav-dock { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; height: var(--nav-h); background: rgba(10, 15, 30, 0.9); backdrop-filter: blur(30px); border-radius: 35px; border: 1px solid var(--glass-border); z-index: 1900; display: flex; justify-content: space-evenly; align-items: center; }
        .nav-btn { background: none; border: none; color: #556677; display: flex; flex-direction: column; align-items: center; font-size: 1.5rem; transition: 0.3s; }
        .nav-btn.active { color: #fff; transform: translateY(-5px); }
        .nav-btn.active span { opacity: 1; }
        .nav-btn span { font-size: 0.6rem; margin-top: 4px; font-weight: 700; opacity: 0; transition: 0.3s; }

        /* === MODALS === */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 5000; align-items: flex-end; justify-content: center; }
        .modal-body { width: 100%; max-width: 600px; background: #111; border-radius: 30px 30px 0 0; padding: 30px; max-height: 90vh; overflow-y: auto; border-top: 1px solid #333; }
    </style>
</head>
<body>

<div id="header-wrapper">
    <header id="main-header" onclick="app.toggleAbout()">
        <div class="brand">LOT Polish Airlines ▾</div>
    </header>
    <div id="about-panel">
        <h3 style="color:#fff;">Commander's Log</h3>
        <p style="color:#666; font-size:0.8rem; margin-bottom:15px;">v156.0 Titanium</p>
        <div style="background:#1a1a1a; padding:15px; border-radius:12px; border:1px solid #333;">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span style="color:#888; font-size:0.8rem;">SERVER</span>
                <span style="color:#22c55e; font-size:0.8rem;">ONLINE (EU)</span>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <span style="color:#888; font-size:0.8rem;">ACARS</span>
                <span style="color:#22c55e; font-size:0.8rem;">CONNECTED</span>
            </div>
        </div>
    </div>
</div>

<div class="nav-dock hidden" id="nav">
    <button class="nav-btn active" onclick="app.nav('dash')"><i>⌂</i><span>HOME</span></button>
    <button class="nav-btn" onclick="app.nav('routes')"><i>✈</i><span>FLIGHTS</span></button>
    <button class="nav-btn" onclick="app.nav('fleet')"><i>◈</i><span>HANGAR</span></button>
    <button class="nav-btn" onclick="app.nav('map')"><i>◍</i><span>MAP</span></button>
    <button class="nav-btn hidden" id="nav-btn-vip" onclick="app.nav('vip')"><i style="color:#ffd700;">♛</i><span style="color:#ffd700;">ELITE</span></button>
</div>

<div class="container hidden" id="app">
    
    <div id="view-dash">
        <div id="pilot-profile-card"></div>
        
        <div id="flight-card" class="anim-item hidden" style="border: 1px solid var(--accent-gold);">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <span style="font-weight:900; color:var(--accent-gold); font-size:0.8rem;">ACTIVE SORTIE</span>
                <span id="af-timer" class="mono" style="font-size:0.9rem;">00:00:00</span>
            </div>
            <h2 id="af-route" style="font-size:2rem; font-weight:200;">DEP - ARR</h2>
            <p id="af-ac" style="color:#888; font-family:'JetBrains Mono'; font-size:0.8rem; margin-bottom:20px;">A320neo</p>
            
            <div style="height:4px; background:rgba(255,255,255,0.1); border-radius:2px; margin-bottom:15px; overflow:hidden;">
                <div id="af-bar" style="height:100%; width:0%; background:var(--accent-gold); transition: width 1s linear;"></div>
            </div>

            <div id="live-map-container"></div>
            
            <button class="btn-primary" style="background:transparent; border:1px solid #444; color:#fff; margin-top:15px;" onclick="app.cancel()">ABORT</button>
        </div>
    </div>

    <div id="view-vip" class="hidden">
        <div class="anim-item vip-card">
            <h3 style="color:#ffd700;">Callsign Override</h3>
            <p style="color:#888; font-size:0.8rem;">Set custom transponder ID. Does not affect login.</p>
            <div class="vip-input-group">
                <input type="text" id="vip-cs-input" class="vip-input" placeholder="ENTER CALLSIGN">
                <button class="vip-save-btn" onclick="app.setCustomCallsign()">SET</button>
            </div>
        </div>

        <div class="anim-item">
            <h3>Classified Intel</h3>
            <div style="margin-top:15px;">
                <div style="border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px;">
                    <div style="color:#ffd700; font-size:0.7rem; font-weight:800;">NOTAM 001</div>
                    <div style="color:#fff; font-size:0.9rem;">Presidential Flight Request</div>
                    <div style="color:#666; font-size:0.8rem;">Prepare BBJ for route EPWA-KJFK. Priority clearance active.</div>
                </div>
                 <div style="border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px;">
                    <div style="color:#ffd700; font-size:0.7rem; font-weight:800;">FLEET UPDATE</div>
                    <div style="color:#fff; font-size:0.9rem;">New Concorde Prototype</div>
                    <div style="color:#666; font-size:0.8rem;">Available for testing in Hangar section for Elite members.</div>
                </div>
            </div>
        </div>

        <div class="anim-item">
            <h3>Elite Routes</h3>
            <div id="vip-routes-list" style="margin-top:15px;">
                </div>
        </div>
    </div>

    <div id="view-routes" class="hidden"><div id="routes-list"></div></div>
    <div id="view-fleet" class="hidden"><div id="fleet-list"></div></div>
    <div id="view-map" class="hidden"><div id="map-wrap" style="height:400px;"></div></div>
    <div id="view-crew" class="hidden"><div id="crew-list"></div></div>

</div>

<div id="login-modal" class="modal-overlay" style="display:flex;">
    <div class="modal-body" style="background:transparent; border:none; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">
        <h1 style="color:#fff; font-size:3rem; margin-bottom:10px;">✈</h1>
        <input type="text" id="travel-id" class="vip-input" style="width:100%; margin-bottom:10px; color:#fff;" placeholder="ID (LOT001)">
        <input type="password" id="travel-pass" class="vip-input" style="width:100%; color:#fff;" placeholder="PASSWORD">
        <button class="btn-primary" onclick="app.login()" style="margin-top:20px;">ENTER SYSTEM</button>
    </div>
</div>

<div id="efb-modal" class="modal-overlay">
    <div class="modal-body">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; padding-bottom:15px; margin-bottom:15px;">
            <span class="mono" style="color:#888;">FLIGHT PLAN</span>
            <span style="background:var(--accent-gold); color:#000; padding:2px 8px; border-radius:4px; font-size:0.7rem; font-weight:800;">READY</span>
        </div>
        
        <div class="ofp-grid">
            <div class="ofp-box"><span class="ofp-lbl">CALLSIGN</span><span class="ofp-val" id="br-cs"></span></div>
            <div class="ofp-box"><span class="ofp-lbl">AIRCRAFT</span><span class="ofp-val" id="br-ac"></span></div>
            <div class="ofp-box"><span class="ofp-lbl">DEP</span><span class="ofp-val" id="br-dep"></span></div>
            <div class="ofp-box"><span class="ofp-lbl">ARR</span><span class="ofp-val" id="br-arr"></span></div>
            <div class="ofp-box"><span class="ofp-lbl">FUEL</span><span class="ofp-val" id="br-fuel"></span></div>
            <div class="ofp-box"><span class="ofp-lbl">TIME</span><span class="ofp-val" id="br-time"></span></div>
        </div>

        <div id="ofp-map-container"></div>

        <button class="btn-primary" style="margin-top:20px; background:#fff; color:#000;" onclick="app.accept()">ACCEPT & SIGN</button>
        <button class="btn-primary" style="margin-top:10px; background:transparent; border:1px solid #333; color:#fff; box-shadow:none;" onclick="app.closeM()">CLOSE</button>
    </div>
</div>

<script>
const DB = {
    PILOTS: [
        { id: "LOT001", pwd: "1234", name: "Capt. Mueller", vip: true },
        { id: "LOT002", pwd: "1234", name: "F.O. Weber", vip: false }
    ],
    ROUTES: [
        { al: "LOT", d: "EPWA", a: "KJFK", t: 9.0, ac: "B787-9", fuel: "75t" },
        { al: "LOT", d: "EDDF", a: "EGLL", t: 1.5, ac: "A320", fuel: "6t" }
    ],
    VIP_ROUTES: [
        { al: "AF1", d: "ADW", a: "EPWA", t: 8.5, ac: "VC-25", fuel: "90t", tag: "STATE" },
        { al: "GOV", d: "EPWA", a: "OMDB", t: 5.5, ac: "B737-BBJ", fuel: "30t", tag: "SUMMIT" }
    ],
    // Simplified coords for Map demo
    COORDS: { "EPWA":[52.1,20.9], "KJFK":[40.6,-73.7], "EDDF":[50.0,8.5], "EGLL":[51.4,-0.4], "ADW":[38.8,-76.8], "OMDB":[25.2,55.3] }
};

const app = {
    user: null, active: null, temp: null, 
    customCS: null, // Stores custom callsign
    
    init: function() {
        // Init logic...
    },

    login: function() {
        const u = document.getElementById('travel-id').value.toUpperCase();
        const p = document.getElementById('travel-pass').value;
        const usr = DB.PILOTS.find(x => x.id === u && x.pwd === p);
        if(usr) {
            this.user = usr;
            document.getElementById('login-modal').style.display='none';
            document.getElementById('nav').classList.remove('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            if(usr.vip) document.getElementById('nav-btn-vip').classList.remove('hidden');
            
            this.nav('dash');
            this.profile();
            this.renderRoutes();
            this.renderVipRoutes();
        } else alert("INVALID");
    },

    toggleAbout: function() {
        document.getElementById('main-header').classList.toggle('open');
        document.getElementById('about-panel').classList.toggle('open');
    },

    nav: function(id) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(id === 'vip') document.getElementById('nav-btn-vip').classList.add('active');
        else event.currentTarget.classList.add('active');
        
        ['dash','routes','fleet','map','vip','crew'].forEach(v => {
            const el = document.getElementById('view-'+v);
            if(el) el.classList.add('hidden');
        });
        const target = document.getElementById('view-'+id);
        if(target) target.classList.remove('hidden');
    },

    profile: function() {
        // Use custom callsign if set, else ID
        const displayCS = this.customCS || this.user.id;
        let badge = this.user.vip ? '<span style="color:#ffd700; border:1px solid #ffd700; padding:2px 5px; font-size:0.7rem; border-radius:4px; margin-left:10px;">VIP</span>' : '';
        
        document.getElementById('pilot-profile-card').className = 'anim-item';
        document.getElementById('pilot-profile-card').innerHTML = `
            <div style="display:flex; align-items:center;">
                <div style="width:50px; height:50px; background:#333; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:15px; font-weight:700;">${this.user.name[0]}</div>
                <div>
                    <div style="font-weight:700;">${this.user.name} ${badge}</div>
                    <div style="font-size:0.8rem; color:#888;">${displayCS}</div>
                </div>
            </div>
        `;
    },

    setCustomCallsign: function() {
        const val = document.getElementById('vip-cs-input').value.toUpperCase();
        if(val) {
            this.customCS = val;
            alert("Transponder Updated: " + val);
            this.profile(); // Update profile view
        }
    },

    renderRoutes: function() {
        const c = document.getElementById('routes-list'); c.innerHTML = '';
        DB.ROUTES.forEach((r, i) => {
            c.innerHTML += this.makeTicket(r, `app.prep(${i}, 'std')`);
        });
    },

    renderVipRoutes: function() {
        const c = document.getElementById('vip-routes-list'); c.innerHTML = '';
        DB.VIP_ROUTES.forEach((r, i) => {
            // Gold border for VIP
            let h = this.makeTicket(r, `app.prep(${i}, 'vip')`);
            h = h.replace('class="ticket"', 'class="ticket" style="border:1px solid #ffd700"');
            c.innerHTML += h;
        });
    },

    makeTicket: function(r, fn) {
        return `<div class="ticket" onclick="${fn}"><div class="ticket-l"><div class="al-tag">${r.al}</div><div class="route-path"><div class="ap">${r.d}</div><div>✈</div><div class="ap">${r.a}</div></div></div><div class="ticket-r">${r.t}h</div></div>`;
    },

    prep: function(idx, type) {
        if(this.active) { alert("Flight Active"); return; }
        const r = type === 'vip' ? DB.VIP_ROUTES[idx] : DB.ROUTES[idx];
        
        this.temp = { ...r, start:0 }; // Store route
        
        // Fill OFP Grid
        document.getElementById('br-cs').innerText = this.customCS || this.user.id;
        document.getElementById('br-ac').innerText = r.ac;
        document.getElementById('br-dep').innerText = r.d;
        document.getElementById('br-arr').innerText = r.a;
        document.getElementById('br-fuel').innerText = r.fuel;
        document.getElementById('br-time').innerText = r.t + 'H';
        
        this.openM('efb-modal');

        // MAP LOGIC FOR OFP
        if(this.user.vip) {
            setTimeout(() => {
                const mc = document.getElementById('ofp-map-container');
                mc.style.display = 'block';
                if(!this.ofpMap) {
                    this.ofpMap = L.map('ofp-map-container', {zoomControl:false}).setView([0,0], 2);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(this.ofpMap);
                }
                this.ofpMap.invalidateSize();
                
                // Draw route
                const c1 = DB.COORDS[r.d] || [50,10];
                const c2 = DB.COORDS[r.a] || [40,-70];
                
                // Clear old
                this.ofpMap.eachLayer(l => { if(l instanceof L.Polyline || l instanceof L.Marker) this.ofpMap.removeLayer(l); });

                const poly = L.polyline([c1, c2], {color: '#c5a47e'}).addTo(this.ofpMap);
                this.ofpMap.fitBounds(poly.getBounds(), {padding:[20,20]});

                // Add Waypoints (Mock)
                L.circleMarker(c1, {color:'#0f0', radius:4}).addTo(this.ofpMap).bindPopup("DEP: "+r.d);
                L.circleMarker(c2, {color:'#f00', radius:4}).addTo(this.ofpMap).bindPopup("ARR: "+r.a);
                // Midpoint mock
                const mid = [(c1[0]+c2[0])/2, (c1[1]+c2[1])/2];
                L.circleMarker(mid, {color:'#fff', radius:3}).addTo(this.ofpMap).bindPopup("WAYPOINT: T1");

            }, 300);
        }
    },

    accept: function() {
        this.closeM();
        this.active = this.temp;
        this.active.startTime = Date.now();
        this.active.durationMs = 20000; // 20 sec demo
        
        this.nav('dash');
        document.getElementById('flight-card').classList.remove('hidden');
        document.getElementById('af-route').innerText = `${this.active.d} - ${this.active.a}`;
        document.getElementById('af-ac').innerText = this.active.ac;
        
        // SETUP LIVE MAP FOR VIP
        if(this.user.vip) {
            const mc = document.getElementById('live-map-container');
            mc.style.display = 'block';
            if(!this.liveMap) {
                this.liveMap = L.map('live-map-container', {zoomControl:false, attributionControl:false});
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(this.liveMap);
            }
            // Logic handled in timer
            const c1 = DB.COORDS[this.active.d] || [50,10];
            const c2 = DB.COORDS[this.active.a] || [40,-70];
            this.liveMap.fitBounds(L.latLngBounds(c1, c2));
            
            // Icon
            const planeIcon = L.divIcon({html: '✈', className: 'plane-icon', iconSize:[24,24], iconAnchor:[12,12]});
            if(this.planeMarker) this.liveMap.removeLayer(this.planeMarker);
            this.planeMarker = L.marker(c1, {icon: planeIcon}).addTo(this.liveMap);
            
            // Draw path
            if(this.liveLine) this.liveMap.removeLayer(this.liveLine);
            this.liveLine = L.polyline([c1, c2], {color:'#444', dashArray:'5,5'}).addTo(this.liveMap);
        }

        this.tmr = setInterval(() => this.tick(), 100);
    },

    tick: function() {
        if(!this.active) return;
        const now = Date.now();
        const el = now - this.active.startTime;
        const pct = Math.min(el / this.active.durationMs, 1);
        
        document.getElementById('af-bar').style.width = (pct*100)+'%';
        
        // Update Live Map Plane
        if(this.user.vip && this.liveMap && this.planeMarker) {
            const c1 = DB.COORDS[this.active.d] || [50,10];
            const c2 = DB.COORDS[this.active.a] || [40,-70];
            const lat = c1[0] + (c2[0]-c1[0]) * pct;
            const lng = c1[1] + (c2[1]-c1[1]) * pct;
            this.planeMarker.setLatLng([lat, lng]);
            this.liveMap.invalidateSize();
        }

        if(pct >= 1) {
            clearInterval(this.tmr);
            alert("Landed");
            this.active = null;
            document.getElementById('flight-card').classList.add('hidden');
        }
    },

    cancel: function() {
        clearInterval(this.tmr);
        this.active = null;
        document.getElementById('flight-card').classList.add('hidden');
    },

    openM: function(id) { document.getElementById(id).style.display='flex'; },
    closeM: function() { document.querySelectorAll('.modal-overlay').forEach(x=>x.style.display='none'); }
};
</script>
<style>
    /* Additional Styles for Map Text/Icons */
    .plane-icon { font-size: 20px; color: #ffd700; text-shadow: 0 0 10px #000; transform: rotate(45deg); }
</style>
</body>
</html>
