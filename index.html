<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lufthansa Helper — animated main UI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg-1:#03061a; --bg-2:#05283a; --text:#eaf4ff; --muted:rgba(234,244,255,0.68);
  --accent-yellow:#ffd54a; --accent-yellow-2:#ffbf3a; --glass-border: rgba(255,255,255,0.06);
  --primary-dark:#072022;
  font-family:Inter,system-ui,Arial,sans-serif; font-size:15px;
}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  *{ animation-duration:0.001ms !important; transition-duration:0.001ms !important; }
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  min-height:100vh;
  background: linear-gradient(160deg,var(--bg-1),var(--bg-2));
  color:var(--text);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  -webkit-font-smoothing:antialiased;
}

/* Layout */
.app-root{display:flex;justify-content:center;align-items:flex-start;padding:18px;min-height:100vh}
.container{width:100%;max-width:1280px}
.hero{ margin-top:28px;border-radius:16px;padding:18px;position:relative;overflow:visible;
  background:
    linear-gradient(180deg, rgba(255,255,255,0.045), rgba(255,255,255,0.02)),
    linear-gradient(180deg, rgba(0,8,20,0.55), rgba(0,8,20,0.65));
  border: 1px solid var(--glass-border);
  box-shadow: 0 20px 60px rgba(2,8,18,0.6);
  backdrop-filter: blur(10px) saturate(140%);
}

/* Header */
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.brand{display:flex;gap:12px;align-items:center;min-width:0}
.logo{width:60px;height:60px;border-radius:12px;background: linear-gradient(180deg,#062b34,#032029);display:flex;align-items:center;justify-content:center;font-weight:900;color:var(--accent-yellow);font-size:18px;box-shadow:0 6px 24px rgba(0,0,0,0.5)}
.title{font-weight:900}
.subtitle{font-size:13px;color:var(--muted)}

/* Tabs */
.tabs{display:flex;gap:10px;margin-top:14px;position:relative;flex-wrap:wrap}
.tab{padding:10px 16px;border-radius:12px;font-weight:800;color:var(--text);background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));border:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:transform .18s,box-shadow .18s,filter .18s}
.tab.active{ transform:translateY(-6px) scale(1.02); box-shadow: 0 22px 60px rgba(0,0,0,0.5)}
.liquid-underline{ position:absolute; height:9px; bottom:-12px; border-radius:8px; background: linear-gradient(90deg,var(--accent-yellow),#ffb84d); transition:left 220ms,width 220ms,opacity 220ms; box-shadow:0 12px 36px rgba(255,160,60,0.14); opacity:0; }

/* Controls */
.controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:16px}
.search{padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:var(--text);min-width:240px}
.durations{display:flex;gap:8px;flex-wrap:wrap}

/* Panels */
.panel{ padding:14px;border-radius:12px;margin-top:12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.06);
  box-shadow:0 30px 80px rgba(2,8,18,0.6);
  backdrop-filter: blur(6px) saturate(130%);
  position:relative;
}

/* Airline grid: animated */
.airline-grid{ margin-top:14px; display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:14px; align-items:start; width:100%; min-width:0; max-height:520px; overflow:auto; padding:14px; border-radius:16px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02)); border:1px solid rgba(255,255,255,0.03); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); }
.airline{ position:relative; display:flex;gap:14px;align-items:center;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));border:1px solid rgba(255,255,255,0.03);box-shadow: 0 12px 36px rgba(0,0,0,0.45);cursor:pointer;transition: transform .22s cubic-bezier(.2,.9,.2,1), box-shadow .22s, filter .18s, background .22s; will-change: transform, box-shadow, filter; transform-origin:center center; overflow:hidden; }
.airline:hover{ transform: translateY(-10px) scale(1.02); box-shadow: 0 44px 120px rgba(0,0,0,0.6); filter:brightness(1.04); }
.airline .dot{ width:18px;height:18px;border-radius:50%;flex:0 0 18px;border:2px solid rgba(255,255,255,0.06); box-shadow: 0 6px 20px rgba(0,0,0,0.5); transition: transform .28s, box-shadow .28s; }
.airline .meta{min-width:0}
.airline .name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis; font-size:15px}
.airline .code{font-size:12px;color:var(--muted)}
.airline .led-accent{ position:absolute; right:12px; top:12px; width:10px; height:10px; border-radius:50%; background:linear-gradient(90deg,var(--accent-yellow),var(--accent-yellow-2)); box-shadow:0 8px 26px rgba(255,170,50,0.12); opacity:0; transform: scale(.85); transition: opacity .28s, transform .28s; }

/* selected state */
.airline.selected{ outline: 2px solid rgba(255,210,80,0.06); box-shadow: 0 40px 130px rgba(255,170,40,0.08); transform: translateY(-12px) scale(1.028); }
.airline.selected .led-accent{ opacity:1; transform: scale(1.1); }

/* card entrance animation (staggered) */
@keyframes cardIn { from{ opacity:0; transform: translateY(18px) scale(.996) } to{ opacity:1; transform: translateY(0) scale(1) } }
.airline[data-idx]{ opacity:0; transform:translateY(18px) scale(.996); animation-name: cardIn; animation-duration:720ms; animation-fill-mode:both; animation-timing-function: cubic-bezier(.2,.9,.2,1); }

/* subtle floating effect when idle */
@keyframes floaty { 0%{ transform: translateY(0) } 50%{ transform: translateY(-4px) } 100%{ transform: translateY(0) } }
.airline.float{ animation: floaty 4200ms ease-in-out infinite; }

/* time pill styles with animation */
.time-pill{ padding:8px 12px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03)); border:1px solid rgba(255,255,255,0.04); cursor:pointer; transition: transform .2s, box-shadow .2s, background .2s; display:flex; align-items:center; gap:10px; font-weight:800; }
.time-pill:hover{ transform: translateY(-6px) scale(1.02); box-shadow: 0 20px 64px rgba(0,0,0,0.48); }
.time-pill.active{ background: linear-gradient(90deg,var(--accent-yellow),var(--accent-yellow-2)); color:var(--primary-dark); box-shadow: 0 28px 84px rgba(255,170,40,0.12); transform: translateY(-8px) scale(1.03); }

/* tab content fade */
.panel{ transition: opacity .28s ease, transform .28s cubic-bezier(.2,.9,.2,1); }
.panel.hidden{ opacity:0; transform: translateY(8px) scale(.997); pointer-events:none; }

/* ripple & spinner base */
.ripple{ position:absolute; border-radius:50%; transform:scale(0); pointer-events:none; opacity:0.38; background:rgba(255,255,255,0.9); transition: transform 520ms cubic-bezier(.2,.9,.2,1), opacity 420ms ease; mix-blend-mode:screen; }

/* small utilities */
.kv{font-size:13px;color:var(--muted)}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:var(--text)}
.row{display:flex;gap:8px;align-items:center;margin-top:10px}

/* focus outlines */
button:focus, .airline:focus{ outline:3px solid rgba(255,210,80,0.12); outline-offset:4px; }

/* splash styles (kept from prior) */
.splash-back{ position:fixed; inset:0; z-index:14000; display:flex; align-items:center; justify-content:center; background: linear-gradient(160deg, rgba(1,6,18,0.98), rgba(2,8,22,0.98)); overflow:hidden; transition: opacity .52s, transform .52s; }
.splash-center{ position:relative; z-index:14010; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; padding:28px; text-align:center; color:var(--text); }
.btn-splash{ padding:12px 20px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.008)); border:1px solid rgba(255,255,255,0.08); color:#fff; font-weight:900; }
.splash-hidden{ opacity:0; transform: translateY(-8px) scale(.997); pointer-events:none; }

/* responsive */
@media(max-width:760px){
  .airline-grid{ grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
  .layout{ grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div id="appRoot" class="app-root" aria-hidden="false">
  <div class="container">
    <div id="appHero" class="hero" role="main" aria-label="Main app">
      <div class="header">
        <div class="brand">
          <div class="logo">LH</div>
          <div>
            <div class="title">Lufthansa Helper</div>
            <div class="subtitle">усиленное LED · liquid glass · демонстрация</div>
          </div>
        </div>

        <div style="display:flex;gap:10px;align-items:center">
          <div id="sessionBadge" class="kv">Неавторизован</div>
          <button id="openGateBtn" class="btn btn-neutral">Вход</button>
          <button id="logoutBtn" class="btn btn-neutral" style="display:none">Выйти</button>
        </div>
      </div>

      <div class="tabs" id="tabsRow" style="margin-top:14px">
        <div class="tab active btn" data-target="panelGenerate" id="tabGen">Генерация</div>
        <div class="tab btn" data-target="panelRoutes" id="tabRoutes">Направления</div>
        <div class="tab btn" data-target="panelFleet" id="tabFleet">Флот</div>
        <div id="liquidUnderline" class="liquid-underline"></div>
      </div>

      <div class="controls">
        <input id="airSearch" class="search" placeholder="Поиск авиакомпании или кода" autocomplete="off" />
        <div style="display:flex;align-items:center;gap:10px">
          <strong class="kv">Время</strong>
          <div id="durations" class="durations"></div>
        </div>

        <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
          <button id="clearBtn" class="btn btn-neutral">Сброс</button>
          <button id="genBtn" class="btn btn-primary">СГЕНЕРИРОВАТЬ</button>
        </div>
      </div>

      <div id="airGrid" class="airline-grid" aria-live="polite"></div>

      <div class="layout" style="display:grid;grid-template-columns:1fr 420px;gap:16px;margin-top:16px;min-width:0">
        <main>
          <section id="panelGenerate" class="panel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:900">Генерация</div>
              <div class="kv">Нажмите СГЕНЕРИРОВАТЬ для демонстрации</div>
            </div>
            <div id="generatedNote" style="margin-top:12px" class="kv">Выберите авиакомпанию и интервал времени</div>
          </section>

          <section id="panelRoutes" class="panel hidden" style="display:block">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:900">Направления</div>
              <div class="kv">Список маршрутов по фильтрам</div>
            </div>
            <div id="routesList" style="margin-top:12px"></div>
          </section>

          <section id="panelFleet" class="panel hidden" style="display:none">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:900">Флот</div>
              <div class="kv">Самолёты под фильтрами</div>
            </div>
            <div id="fleetList" style="margin-top:12px"></div>
          </section>
        </main>

        <aside>
          <div class="panel" style="padding:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:900">Пилоты</div>
              <div class="kv">Demo</div>
            </div>
            <div style="margin-top:8px">
              <input id="pilotSearch" class="input" placeholder="Поиск пилота" />
            </div>
            <div id="pilotList" style="margin-top:8px"></div>
          </div>

          <div class="panel" style="margin-top:12px;padding:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:900">Актуальные рейсы</div>
              <div class="kv">Сохранены в локальном хранилище</div>
            </div>
            <div id="currentFlights" class="kv" style="margin-top:8px;max-height:160px;overflow:auto">Нет текущих рейсов</div>
            <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:900">Журнал</div>
              <div><button id="openGate2" class="btn btn-ghost">Вход</button></div>
            </div>
            <div id="log" class="kv" style="margin-top:8px;max-height:320px;overflow:auto">Пусто</div>
          </div>
        </aside>
      </div>
    </div>
  </div>
</div>

<!-- Splash -->
<div id="splash" class="splash-back" role="dialog" aria-modal="true" aria-label="Welcome overlay">
  <div class="splash-center">
    <h2 id="splashTitle">Welcome to Lufthansa Group</h2>
    <div class="splash-sub" style="color:var(--muted)">Демонстрационный интерфейс · выбор авиакомпаний и интервалов</div>
    <div class="center-cta">
      <button id="splashContinue" class="btn-splash" aria-label="Дальше">Дальше</button>
    </div>
  </div>
</div>

<!-- Gate modal -->
<div id="gateModal" class="modal-back" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Вход">
    <div style="font-weight:900">Вход в систему</div>
    <div class="small kv" style="margin-top:8px">Кодовое слово: <strong>quickaccess2025</strong></div>
    <div class="row" style="margin-top:10px"><input id="loginCall" class="input" placeholder="Позывной (callSign)" autocomplete="username" /></div>
    <div class="row"><input id="loginPass" class="input" placeholder="Пароль или кодовое слово" type="password" autocomplete="current-password" /></div>
    <div class="row" style="align-items:center;margin-top:12px"><input id="tourAfterLogin" type="checkbox" checked /><label for="tourAfterLogin" style="margin-left:6px">Показать инструкцию после входа</label></div>
    <div style="display:flex;justify-content:space-between;gap:8px;margin-top:14px">
      <button id="btnDemoQuick" class="btn btn-neutral">Быстрый вход</button>
      <button id="btnLogin" class="btn btn-primary">Войти</button>
    </div>
  </div>
</div>

<!-- Tour -->
<div id="tour" class="modal-back" style="display:none;align-items:center;justify-content:center" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div style="font-weight:900">Краткая инструкция</div>
    <div class="small kv" style="margin-top:8px">1) Выберите авиакомпанию; 2) Выберите интервал времени; 3) Нажмите СГЕНЕРИРОВАТЬ; 4) Подтвердите бронь.</div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px"><button id="tourSkip" class="btn btn-neutral">Пропустить</button><button id="tourDone" class="btn btn-primary">Готово</button></div>
  </div>
</div>

<!-- Confirm -->
<div id="confirmModal" class="modal-back" style="display:none;" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Подтвердить бронь">
    <div style="font-weight:900">Подтвердить рейс</div>
    <div id="confirmDetails" class="kv" style="margin-top:8px"></div>
    <div style="display:flex;justify-content:space-between;gap:8px;margin-top:12px"><button id="confirmCancel" class="btn btn-neutral">Отменить</button><button id="confirmAccept" class="btn btn-primary">Подтвердить</button></div>
  </div>
</div>

<script>
/* ------------------ Data & Helpers ------------------ */
const CODEWORD = 'quickaccess2025';
const DURATIONS = [
  {label:"1–2ч",min:60,max:120},{label:"2–3ч",min:120,max:180},{label:"3–4ч",min:180,max:240},
  {label:"5–6ч",min:300,max:360},{label:"6–7ч",min:360,max:420},{label:"7–8ч",min:420,max:480},
  {label:"8–9ч",min:480,max:540},{label:"9–10ч",min:540,max:600},{label:"10+ч",min:600,max:99999}
];
const AIRLINES = [
  {name:"Lufthansa",code:"LH",color:"#1E6FFF"},
  {name:"Lufthansa Cargo",code:"G0",color:"#0A63D6"},
  {name:"Eurowings",code:"EW",color:"#8A4BFF"},
  {name:"Condor",code:"DE",color:"#FFD200"},
  {name:"Swiss",code:"LX",color:"#D81E5B"},
  {name:"Austrian",code:"OS",color:"#DA291C"},
  {name:"Brussels",code:"SN",color:"#003399"},
  {name:"SunExpress",code:"SX",color:"#FF8A3D"}
];

let chosenAirline = null;
let chosenDuration = null;
let searchQuery = '';
let FLEET_LOG = [];
let CURRENT_FLIGHTS = [];

/* DOM refs */
const airGrid = document.getElementById('airGrid');
const durWrap = document.getElementById('durations');
const airSearch = document.getElementById('airSearch');
const splash = document.getElementById('splash');
const splashContinue = document.getElementById('splashContinue');
const gateModal = document.getElementById('gateModal');
const loginCall = document.getElementById('loginCall');
const loginPass = document.getElementById('loginPass');
const btnLogin = document.getElementById('btnLogin');
const btnDemoQuick = document.getElementById('btnDemoQuick');
const openGateBtn = document.getElementById('openGateBtn');
const openGate2 = document.getElementById('openGate2');
const logoutBtn = document.getElementById('logoutBtn');
const sessionBadge = document.getElementById('sessionBadge');
const tourModal = document.getElementById('tour');
const tourAfterLogin = document.getElementById('tourAfterLogin');

function uid(prefix='id'){ return prefix+'_'+Math.random().toString(36).slice(2,9); }

/* ------------------ Render: durations (animated) ------------------ */
function renderDurations(){
  durWrap.innerHTML='';
  DURATIONS.forEach((d,i)=>{
    const b = document.createElement('div');
    b.className='time-pill';
    b.dataset.idx = i;
    b.innerHTML = `<div style="display:flex;align-items:center;gap:8px"><div style="width:10px;height:10px;border-radius:50%;background:linear-gradient(90deg,var(--accent-yellow),var(--accent-yellow-2))"></div><div style="font-weight:800">${d.label}</div></div>`;
    b.addEventListener('click', ()=> {
      if(chosenDuration === i){ chosenDuration = null; b.classList.remove('active'); } else { chosenDuration = i; }
      // update active states
      Array.from(durWrap.children).forEach((c,idx)=> c.classList.toggle('active', idx===chosenDuration));
      filterAndRenderAirlines();
    });
    // small staggered entrance
    b.style.opacity = '0'; b.style.transform = 'translateY(8px)';
    durWrap.appendChild(b);
    requestAnimationFrame(()=> {
      setTimeout(()=>{ b.style.transition='transform 420ms cubic-bezier(.2,.9,.2,1), opacity 420ms'; b.style.opacity='1'; b.style.transform='translateY(0)'; }, 80*i);
    });
  });
}

/* ------------------ Render: airline cards with animations ------------------ */
function filterAndRenderAirlines(){
  airGrid.innerHTML = '';
  const filtered = AIRLINES.filter(a=>{
    if(!searchQuery) return true;
    const q = searchQuery.toLowerCase();
    return a.name.toLowerCase().includes(q) || (a.code && a.code.toLowerCase().includes(q));
  });
  filtered.forEach((a, i) => {
    const card = document.createElement('div');
    card.className = 'airline';
    card.dataset.airline = a.name;
    card.dataset.idx = i;
    card.innerHTML = `
      <div class="dot" style="background:${a.color}"></div>
      <div class="meta">
        <div class="name">${a.name}</div>
        <div class="code">${a.code}</div>
      </div>
      <div class="led-accent" aria-hidden="true"></div>
    `;
    // entrance stagger
    card.style.animationDelay = (i * 80) + 'ms';
    // add small float on idle with randomized offset to avoid uniform motion
    setTimeout(()=> card.classList.add('float'), 900 + (i%3)*120);
    // hover and selection interactions
    card.addEventListener('click', ()=>{
      const was = card.classList.contains('selected');
      // clear previous selections
      Array.from(document.querySelectorAll('.airline.selected')).forEach(c=>c.classList.remove('selected'));
      if(!was){
        card.classList.add('selected');
        chosenAirline = a.name;
      } else {
        chosenAirline = null;
      }
      // visual LED pulse
      const led = card.querySelector('.led-accent');
      if(led){ led.animate([{ transform:'scale(1.6)', opacity:1 }, { transform:'scale(1)', opacity:1 }], { duration:420, easing:'cubic-bezier(.2,.9,.2,1)' }); }
      // also slightly pulse the dot
      const dot = card.querySelector('.dot');
      if(dot){ dot.animate([{ transform:'scale(1.06)' }, { transform:'scale(1)' }], { duration:420, easing:'ease-out' }); }
      // apply filter
      filterAndRenderAirlines();
      renderRoutes(); renderFleet();
    });
    // keyboard accessibility
    card.tabIndex = 0;
    card.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') card.click(); });

    // micro ripple on pointerdown
    card.addEventListener('pointerdown', (ev)=>{
      let r = card.querySelector('.ripple');
      if(!r){ r = document.createElement('span'); r.className='ripple'; card.prepend(r); }
      const rect = card.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height) * 1.6;
      r.style.width = r.style.height = size + 'px';
      r.style.left = (ev.clientX - rect.left - size/2) + 'px';
      r.style.top = (ev.clientY - rect.top - size/2) + 'px';
      r.style.transform = 'scale(0)'; r.style.opacity = '0.36';
      requestAnimationFrame(()=> { r.style.transition = 'transform 520ms cubic-bezier(.2,.9,.2,1), opacity 420ms'; r.style.transform = 'scale(1)'; });
      setTimeout(()=> { if(r) r.style.opacity = '0'; }, 360);
    }, {passive:true});

    airGrid.appendChild(card);
  });
}

/* ------------------ Routes & Fleet simple render (kept small) ------------------ */
let ROUTES = [];
function generateRoutes(){
  const base = ["EDDF","EGLL","LFPG","LEBL","LSZH","KJFK","EHAM","EBBR","LIRF","LOWW","ENBR","EKCH","ESSA","LIMC"];
  let seq = 100;
  AIRLINES.forEach((a, ai)=>{
    for(let i=0;i<5;i++){
      const from = base[(ai + i) % base.length];
      const to = base[(ai + i + 3) % base.length];
      const duration = 60 + (i*30) + (ai*15);
      ROUTES.push({ id: `${a.code}-${seq++}`, airline: a.name, airlineCode: a.code, fromICAO: from, toICAO: to, fromCity:'City-'+from, toCity:'City-'+to, durationMinutes:duration });
    }
  });
}
generateRoutes();

const routesList = document.getElementById('routesList');
const fleetList = document.getElementById('fleetList');
function renderRoutes(){
  routesList.innerHTML = '';
  const list = ROUTES.filter(r=>{
    if(chosenAirline && r.airline !== chosenAirline) return false;
    if(chosenDuration !== null){ const d = DURATIONS[chosenDuration]; if(!(r.durationMinutes >= d.min && r.durationMinutes <= d.max)) return false; }
    return true;
  });
  if(!list.length){ routesList.innerHTML = '<div class="kv">Нет направлений</div>'; return; }
  list.forEach(r=>{
    const row = document.createElement('div');
    row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='10px'; row.style.borderRadius='10px'; row.style.marginTop='8px';
    row.style.background='linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02))';
    row.innerHTML = `<div><div style="font-weight:800">${r.fromICAO} → ${r.toICAO} · ${r.airlineCode}</div><div class="kv">${r.fromCity} → ${r.toCity}</div></div><div style="text-align:right"><div class="kv">${r.durationMinutes} мин</div><div style="margin-top:8px"><button class="btn btn-primary select-route" data-id="${r.id}">Выбрать</button></div></div>`;
    routesList.appendChild(row);
  });
  // bind selects
  Array.from(document.querySelectorAll('.select-route')).forEach(b=>{
    b.addEventListener('click', ()=> {
      const id = b.dataset.id;
      const route = ROUTES.find(x=>x.id===id);
      if(route) openConfirmFromRoute(route);
    });
  });
}

function renderFleet(){
  fleetList.innerHTML = '';
  // demo static
  const demo = [
    {id:'LH-A320-01',airline:'Lufthansa',type:'A320',fuel:420},
    {id:'LX-A320-01',airline:'Swiss',type:'A320',fuel:380},
    {id:'DE-B767-01',airline:'Condor',type:'B767',fuel:780}
  ];
  demo.forEach(d=>{
    const el = document.createElement('div');
    el.style.display='flex'; el.style.justifyContent='space-between'; el.style.alignItems='center'; el.style.marginTop='8px';
    el.innerHTML = `<div style="font-weight:800">${d.id}</div><div class="kv">${d.airline} · ${d.type} · ${d.fuel} мин</div>`;
    fleetList.appendChild(el);
  });
}

/* ------------------ Selection/filters ------------------ */
airSearch.addEventListener('input', ()=>{ searchQuery = airSearch.value.trim(); filterAndRenderAirlines(); });
document.getElementById('clearBtn').addEventListener('click', ()=>{ searchQuery=''; airSearch.value=''; chosenAirline=null; chosenDuration=null; Array.from(durWrap.children).forEach(c=>c.classList.remove('active')); filterAndRenderAirlines(); renderRoutes(); renderFleet(); });

/* ------------------ Confirm reservation simple flow (kept) ------------------ */
function openConfirmFromRoute(route){
  // if not logged in, open gate modal
  if(!isLogged()){ showGateModal(); return; }
  document.getElementById('confirmDetails').textContent = `${route.id} · ${route.fromICAO}→${route.toICAO} · ${route.durationMinutes} мин`;
  document.getElementById('confirmModal').style.display = 'flex';
}

/* ------------------ Auth / modals (simplified) ------------------ */
let currentUser = null;
function isLogged(){ return !!currentUser; }
function showGateModal(){ gateModal.style.display='flex'; gateModal.setAttribute('aria-hidden','false'); setTimeout(()=> loginCall.focus(),50); }
function hideGateModal(){ gateModal.style.display='none'; gateModal.setAttribute('aria-hidden','true'); }
btnDemoQuick.addEventListener('click', ()=>{ loginCall.value = 'FRENCH'; loginPass.value = CODEWORD; btnLogin.click(); });
btnLogin.addEventListener('click', ()=> {
  const cs = (loginCall.value||'').trim();
  const pass = (loginPass.value||'').trim();
  if(!cs || !pass){ alert('Введите позывной и пароль'); return; }
  // demo auth
  if(pass === CODEWORD){
    currentUser = {callsign: cs}; sessionBadge.textContent = 'Вошёл ' + cs; hideGateModal();
    // after login optionally show tour
    if(tourAfterLogin && tourAfterLogin.checked){ setTimeout(()=> openTour(), 420); }
  } else { alert('Неверный пароль'); }
});

/* simple tour open/close */
function openTour(){ tourModal.style.display='flex'; tourModal.setAttribute('aria-hidden','false'); }
document.getElementById('tourSkip').addEventListener('click', ()=>{ tourModal.style.display='none'; tourModal.setAttribute('aria-hidden','true'); });
document.getElementById('tourDone').addEventListener('click', ()=>{ tourModal.style.display='none'; tourModal.setAttribute('aria-hidden','true'); });

openGateBtn.addEventListener('click', showGateModal);
openGate2.addEventListener('click', showGateModal);

/* ------------------ Splash: seamless hide + open modal + tour ------------------ */
splashContinue.addEventListener('click', async ()=> {
  // micro animation
  splashContinue.animate([{ transform:'scale(.98)' }, { transform:'scale(1)' }], { duration:180, easing:'cubic-bezier(.2,.9,.2,1)' });
  // hide splash
  splash.classList.add('splash-hidden');
  await new Promise(r=>setTimeout(r,520));
  splash.style.display = 'none';
  // open gate modal immediately and then tour (if checked)
  showGateModal();
  setTimeout(()=> { if(tourAfterLogin && tourAfterLogin.checked) openTour(); }, 480);
});

/* ------------------ Tabs underline placement ------------------ */
const tabs = Array.from(document.querySelectorAll('.tab'));
const underline = document.getElementById('liquidUnderline');
function placeUnderlineActive(){
  const active = document.querySelector('.tab.active');
  if(!active){ underline.style.opacity = '0'; return; }
  const pRect = active.parentElement.getBoundingClientRect();
  const r = active.getBoundingClientRect();
  underline.style.left = (r.left - pRect.left) + 'px';
  underline.style.width = r.width + 'px';
  underline.style.opacity = '1';
}
tabs.forEach(t=>{
  t.addEventListener('click', ()=> {
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const target = t.dataset.target;
    document.querySelectorAll('.panel').forEach(p=> p.classList.add('hidden') );
    const el = document.getElementById(target);
    if(el){ el.classList.remove('hidden'); el.style.display = 'block'; el.style.opacity = '1'; el.style.transform = 'translateY(0)'; }
    placeUnderlineActive();
  });
});
window.addEventListener('resize', placeUnderlineActive);

/* ------------------ Init renders ------------------ */
function init(){
  renderDurations();
  filterAndRenderAirlines();
  renderRoutes();
  renderFleet();
  placeUnderlineActive();
}
init();
</script>
</body>
</html>
